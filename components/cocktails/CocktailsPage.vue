<template>
    <div class="cocktails">
        <div class="cocktails__header cocktails-header">
            <h1 class="cocktails-header__title">
                {{ pageTitle }}
            </h1>
            <CocktailsSorting class="cocktails-header__sorting" />
        </div>
        <div class="cocktails__body cocktails-body">
            <CocktailsFilters
                :filterList="allFilters"
                :allCocktailsNumber="cocktailsFull.totalCount"
                :futureCounts="cocktailsFull.futureCounts"
                class="cocktails-body__filter"
            />
            <div class="cocktails-body__wrapper">
                <CocktailsList
                    :cocktails="cocktailsFirst"
                    isFirstList
                    class="cocktails-body__list"
                />
                <div class="cocktails-body__ads">
                    <ins
                        class="adsbygoogle"
                        style="display: block"
                        data-ad-format="fluid"
                        data-ad-layout-key="-gh-4+1q-51+45"
                        data-ad-client="ca-pub-9033785625371866"
                        data-ad-slot="2682031593"
                    />
                </div>
                <CocktailsList
                    v-if="checkLength"
                    :cocktails="cocktailsSecond"
                    class="cocktails-body__list"
                />
            </div>
        </div>
        <Pagination
            v-if="cocktailsFull.totalCount > 24"
            @load-more="loadMore"
            :totalItems="cocktailsFull.totalCount"
            :limit="24"
            class="cocktails__pagination"
        />
    </div>
</template>

<script>
import CocktailsList from './../global/CocktailsList.vue'
import CocktailsFilters from './CocktailsFilters.vue'
import Pagination from '../dump/Pagination.vue'
import CocktailsSorting from './CocktailsSorting.vue'
import { onBeforeMount, defineComponent, computed, toRefs, unref } from 'vue'
import { store } from '~~/store/filter'
import { head } from '~~/utils/head'
export default defineComponent({
    name: 'CocktailsPage',
    components: {
        CocktailsFilters,
        Pagination,
        CocktailsList,
        CocktailsSorting
    },
    props: {
        allFilters: {
            type: Array,
            required: true
        },
        cocktailsFull: {
            type: Object,
            required: true
        }
    },
    emits: ['loadMore'],
    setup(props, { emit }) {
        const { allFilters, cocktailsFull } = toRefs(props)

        const checkLength = computed(
            () => unref(cocktailsFull).cocktails.length > 12
        )
        const cocktailsFirst = computed(() =>
            unref(checkLength)
                ? unref(cocktailsFull).cocktails.slice(0, 12)
                : unref(cocktailsFull).cocktails
        )
        const cocktailsSecond = computed(() =>
            unref(checkLength) ? unref(cocktailsFull).cocktails.slice(12) : []
        )

        const setOpenList = () =>
            store.actions.setFiltersIsOpenList(unref(allFilters))

        onBeforeMount(() => {
            setOpenList()
        })

        const pageTitle = computed(() =>
            unref(cocktailsFull).description
                ? unref(cocktailsFull).description
                : 'Коктейлі'
        )

        const scripts = [
            {
                async: true,
                src: 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9033785625371866',
                crossorigin: 'anonymous'
            },
            {
                innerHTML: `;(adsbygoogle = window.adsbygoogle || []).push({})`
            }
        ]

        const headTitle = unref(cocktailsFull).description
            ? `${
                  unref(cocktailsFull).description
              } 🍹 та рецепти до них в домашніх умовах`
            : 'Колекція коктейлів 🍹 та рецептів до них в домашніх умовах'

        const headDescription = unref(cocktailsFull).description
            ? `${
                  unref(cocktailsFull).description
              } 🍸 з фото та рецептами, оберий який подобаєтья тобі`
            : 'Коктейлі алкогольні 🍸 та безалкогольні 🍹 з фото та рецептами, оберий який подобаєтья тобі'

        head({
            title: headTitle,
            description: headDescription,
            indexPage: unref(cocktailsFull).isAddToIndex,
            scripts: scripts
        })

        const loadMore = (newQuery) => {
            emit('loadMore', newQuery)
        }

        return {
            cocktailsFirst,
            cocktailsSecond,
            checkLength,
            pageTitle,
            loadMore
        }
    }
})
</script>

<style lang="scss" scoped>
@import './styles/cocktails-page';
</style>

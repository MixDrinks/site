<template>
    <div class="cocktails">
        <div class="cocktails__header cocktails-header">
            <h1 class="cocktails-header__title">
                {{ title }}
            </h1>
            <Sorting class="cocktails-header__sorting" />
        </div>
        <div class="cocktails__body cocktails-body">
            <FilterList
                class="cocktails-body__filter"
                :filterList="allFilters"
                :totalCount="cocktailsFull.totalCount"
                :futureCounts="cocktailsFull.futureCounts"
            />
            <div class="cocktails-body__wrapper">
                <CocktailsList
                    class="cocktails-body__list"
                    isFirstList
                    :cocktails="cocktailsFirst"
                />
                <div class="cocktails-body__ads">
                    <ins
                        class="adsbygoogle"
                        style="display: block"
                        data-ad-format="fluid"
                        data-ad-layout-key="-gh-4+1q-51+45"
                        data-ad-client="ca-pub-9033785625371866"
                        data-ad-slot="2682031593"
                    ></ins>
                </div>
                <CocktailsList
                    v-if="checkLength"
                    class="cocktails-body__list"
                    :cocktails="cocktailsSecond"
                />
            </div>
        </div>
        <Pagination
            v-if="cocktailsFull.totalCount > 24"
            class="cocktails__pagination"
            :totalItems="cocktailsFull.totalCount"
            :limit="24"
            @loadMore="loadMore"
        />
    </div>
</template>

<script>
import CocktailsList from './CocktailsList.vue'
import FilterList from './FilterList.vue'
import Pagination from '../dump/Pagination.vue'
import Sorting from './Sorting.vue'
import { onBeforeMount, defineComponent, computed, toRefs, unref } from 'vue'
import { store } from '~~/store/filter'
import { useHead, useRoute } from 'nuxt/app'
export default defineComponent({
    name: 'CocktailsPage',
    components: { FilterList, Pagination, CocktailsList, Sorting },

    props: {
        allFilters: {
            type: Array,
            required: true,
        },
        cocktailsFull: {
            type: Object,
            required: true,
        },
    },
    setup(props, { emit }) {
        const route = useRoute()
        const { allFilters, cocktailsFull } = toRefs(props)
        const title = computed(() => {
            return unref(cocktailsFull).description
                ? unref(cocktailsFull).description
                : 'Коктейлі'
        })
        const checkLength = computed(() => {
            return unref(cocktailsFull).cocktails.length > 12
        })
        const cocktailsFirst = computed(() => {
            return unref(checkLength)
                ? unref(cocktailsFull).cocktails.slice(0, 12)
                : unref(cocktailsFull).cocktails
        })
        const cocktailsSecond = computed(() => {
            return unref(checkLength)
                ? unref(cocktailsFull).cocktails.slice(12)
                : []
        })
        const setOpenList = () =>
            store.actions.setFiltersIsOpenList(unref(allFilters))

        onBeforeMount(() => {
            setOpenList()
        })

        const canonical = computed(() => route.path)

        const indexPage = computed(() =>
            unref(cocktailsFull).isAddToIndex
                ? 'index, follow'
                : 'noindex, nofollow'
        )
        const description = computed(() => {
            return unref(cocktailsFull).description
                ? `${
                      unref(cocktailsFull).description
                  } 🍸 з фото та рецептами, оберий який подобаєтья тобі`
                : 'Коктейлі алкогольні 🍸 та безалкогольні 🍹 з фото та рецептами, оберий який подобаєтья тобі'
        })
        const metaTitle = computed(() => {
            return unref(cocktailsFull).description
                ? `${
                      unref(cocktailsFull).description
                  } 🍹 та рецепти до них в домашніх умовах`
                : 'Колекція коктейлів 🍹 та рецептів до них в домашніх умовах'
        })

        useHead({
            title: unref(metaTitle),
            link: [{ rel: 'canonical', href: unref(canonical) }],
            meta: [
                {
                    hid: 'description',
                    name: 'description',
                    content: unref(description),
                },
                {
                    hid: 'og:title',
                    name: 'og:title',
                    content: unref(metaTitle),
                },
                {
                    hid: 'og:description',
                    property: 'og:description',
                    content: unref(description),
                },
                {
                    hid: 'og:url',
                    property: 'og:url',
                    content: `${unref(canonical)}`,
                },
                { name: 'robots', content: unref(indexPage) },
            ],
            script: [
                {
                    async: true,
                    src: 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9033785625371866',
                    crossorigin: 'anonymous',
                },
                {
                    InnerHTML: `;(adsbygoogle = window.adsbygoogle || []).push({})`,
                },
            ],
        })

        const loadMore = (newQuery) => {
            emit('loadMore', newQuery)
        }

        return {
            cocktailsFirst,
            cocktailsSecond,
            checkLength,
            title,
            loadMore,
        }
    },
})
</script>

<style lang="scss" scoped>
@import './styles/cocktails-page';
</style>
